<!DOCTYPE html>
<html lang="en">
<head id="head">
  <!--Page Data-->
  <title>Schmidts.Page</title>
  <meta name="description" content="Schmidts.Page is an Alpha rendition of what will be later released as a set of tools for RPGs on the fly.">
  <link rel="shortcut icon" href="/Site-Stuff/Assets/Images/golden_bed.ico">
  <style>
    label:not([hidden]){
      display: block;
    }
    /* body.new-task-page {
      min-width: min-content;
    } */
    main.new-task-page {
      margin: 0 1vw 0 1vw;
    }
    #submit-button {
      font-size: 1em;
      margin: 1em 1em 1em 1.5em;
      height: fit-content;
      transition-duration: 1s;
      transition-property: margin;
    }
    @media(max-width: 364px){
      #submit-button{
        margin: 1em 50% 0 40%;
        
      }
    }
  </style>
</head>
<body class="new-task-page">
    <header id="site-wide-nav-header">
      
    </header>
    <main class="new-task-page">
      <form>
        <fieldset>
          <legend>New Task</legend>
          <input name="taskName" id="taskName" type="text" maxlength="50" placeholder="Task Name Here" required>
        </fieldset>
        <fieldset id="lvlOfImportance">
          <label for="eminanceOfFailure">Eminance of Failure when missed</label>
          <select name="eminanceOfFailure" id="eminanceOfFailure" placeholder="Please Choose..." onchange="showTheThing('eminanceOfFailure', 'Cumulative', 'cumulaNum')" required>
            <option>Immediate</option>
            <option>Cumulative</option>
            <option>Nugatory</option>
          </select>
          <label for="cumulaNum" id="cumulaNumLabel" hidden>Cumulative Limit Before Failure</label>
          <input name="cumulaNum" id="cumulaNum" type="number" step="1" hidden>
          <label for="failures" id="failuresLabel" hidden>Failures so far</label>
          <input name="failures" id="failures" type="number" step="1" value="0" hidden>
        </fieldset>
        <fieldset>
          <label for="taskUnits">Units of Measurement</label>
          <select name="taskUnits" id="taskUnits" placeholder="Please Choose..." onchange="showTheThing('taskUnits', 'Custom Units', 'customUnits')" required>
            <option>Number (No Units)</option>
            <option>Custom Units</option>
            <option>Time</option>
          </select>
          <label for="taskQuantity">Quantity Needed to Complete</label>
          <input name="taskQuantity" id="taskQuantity" type="number" value="1" required>
          <label for="customUnits" id="customUnitsLabel" hidden>Custom Units Name</label>
          <input name="customUnits" id="customUnits" type="text" hidden>
        </fieldset>
        <fieldset>
          <label for="taskHourReset">Reset at this time of day</label>
          <input name="taskHourReset" id="taskHourReset" type="time" value="06:00"> <!--note, be sure to make this one automatically reset at midnight if no number is given...somehow.-->
          <label for="taskDayReset">Reset after this many days</label>
          <input name="taskDayReset" id="taskDayReset" type="number" value="1" size="" required>
          <label for="taskTimeAllowed">Time allowed for completion (in minutes)</label>
          <input name="taskTimeAllowed" id="taskTimeAllowed" type="number" required>
        </fieldset>
        <fieldset>
          <!-- <label for=""></label>
          <input name="" type="">
          <label for=""></label>
          <input name="" type=""> -->
          <label for="desc">Additional Notes:</label>
          <textarea name="desc" id="desc" maxlength="555" placeholder="Write notes here..."></textarea>
        </fieldset>
        <button id="submit-button" onclick="getAndSetParams(event)">Submit</button>
      </form>
      
    </main>
    <footer id="main-footer">

    </footer>
</body>
<script src="/Site-Stuff/Scripting/Snippets/template_level_snippets.js"></script>
<script>
  //filling inputs if available
  let params = new URLSearchParams(window.location.search);
  let currentTask = params.get("taskName");
  if(currentTask){
    console.log(`1. ${localStorage.getItem("Task-List")}`)
    let taskInfo = JSON.parse(localStorage.getItem("Task-List"));
    console.log(`2. ${taskInfo}`)
  }
  function formatDuration(seconds) {
    let days = Math.floor(seconds / (3600 * 24));
    let hours = Math.floor((seconds % (3600 * 24)) / 3600);
    let minutes = Math.floor((seconds % 3600) / 60);
    let remainingSeconds = seconds % 60;
    
    let result = '';
    if (days > 0) {result += days + ':';}
    if (hours > 0 || days > 0) {if (hours < 10) {result += '0';} result += hours + ':';}
    if (minutes > 0 || hours > 0 || days > 0) {if (minutes < 10) {result += '0';} result += minutes + ':';}
    if (remainingSeconds < 10) {result += '0';}
    result += remainingSeconds;
    
    return result;
  }
  function getAndSetParams(event) {
    // Prevent the default form submission behavior
    console.log("working");
    event.preventDefault();
    // Create a new object to store the form data
    let newTask = {};

    //////////////Getting values from the form and add them to the new object/////////////////
    newTask.taskName = document.querySelector('#taskName').value;
    newTask.eminanceOfFailure = document.querySelector('#eminanceOfFailure').value;
    newTask.cumulaNum = document.querySelector('#cumulaNum').value;
    newTask.taskUnits = document.querySelector('#taskUnits').value;
    newTask.taskQuantity = document.querySelector('#taskQuantity').value;
    newTask.customUnits = document.querySelector('#customUnits').value;
    newTask.taskHourReset = document.querySelector('#taskHourReset').value;
    newTask.taskDayReset = document.querySelector('#taskDayReset').value;
    newTask.taskTimeAllowed = document.querySelector('#taskTimeAllowed').value;
    newTask.desc = document.querySelector('#desc').value;
    newTask.numberOfFailures = document.querySelector('#failures').value;
    newTask.lastCompleted = new Date;
    newTask.backgroundColor = "white";
    /////////////////////////// getting time difference////////////////////////
    // Get the current time in hours and minutes
    const now = new Date();
    const currentHours = now.getHours();
    const currentMinutes = now.getMinutes();

    // Get the user-specified date and time in hours and minutes
    console.log(newTask.taskHourReset);
    const userInputTime = newTask.taskHourReset;
    const timeParts = userInputTime.split(":");
    const userDays = newTask.taskDayReset;
    const userHours = parseInt(timeParts[0]);
    const userMinutes = parseInt(timeParts[1]);

    // Calculate the difference in Seconds then converting back to days hours minutes seconds
    let differenceInSeconds = ((userDays - 1) * 60 * 24 + (userHours - currentHours) * 60 + (userMinutes - currentMinutes)) * 60;

    if (differenceInSeconds <= 0) {
      differenceInSeconds = ((24*60*60) + differenceInSeconds);
    }
    newTask.timeRemaining = differenceInSeconds;
    newTask.timeRemainingVisualized = formatDuration(differenceInSeconds);
    newTask.originalTimeRemaining = differenceInSeconds;
    


    // Get the existing task list from localStorage or initialize it as an empty object
    let taskList = JSON.parse(localStorage.getItem('Task-List')) || {};

    // Add the new task to the task list using the task name as the key
    taskList[newTask.taskName] = newTask;

    // Save the updated task list back to localStorage
    localStorage.setItem('Task-List', JSON.stringify(taskList));

    // Navigate to the task list page
    window.location.href = '/Family/Gunnar/Planner/New_Task.html';
  }

  // getAndSetParams();


  function showTheThing(theId, verifyText, theThingsId){
    let theThingOption = document.getElementById(`${theId}`).value;
    let theThing = document.getElementById(`${theThingsId}`);
    let theThingsLabel = document.getElementById(`${theThingsId}Label`)

    if(theThingOption === verifyText){
      theThing.removeAttribute("hidden");
      theThingsLabel.removeAttribute("hidden");
      theThing.required = true;
      theThingsLabel.required = true;
      console.log("Ohhh")
    } else {
      theThing.hidden = true;
      theThingsLabel.hidden = true;
      theThing.removeAttribute("required");
      theThingsLabel.removeAttribute("required");
      console.log("snap")
    }
  }
  // function setUnitOfMeasurement(){
  //   let unitOption = document.getElementById("taskUnits")
  // }

  

  function storeFormData(){
    console.log("yeah");
  }
  function displayTaskInfo(){

  }
  
</script>
</html>
<!-- cumulaNum=5&taskUnits=Number+%28No+Units%29&taskQuantity=30&customUnits=&taskHourReset=06%3A00&taskDayReset=1&taskTimeAllowed=1440&desc= -->