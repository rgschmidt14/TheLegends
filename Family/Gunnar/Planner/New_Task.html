<!DOCTYPE html>
<html lang="en">
<head id="head">
  <!--Page Data-->
  <title>Schmidts.Page</title>
  <meta name="description" content="Schmidts.Page is an Alpha rendition of what will be later released as a set of tools for RPGs on the fly.">
  <link rel="shortcut icon" href="/Site-Stuff/Assets/Images/golden_bed.ico">
  <style>
    label:not([hidden]){
      display: block;
    }
    /* body.new-task-page {
      min-width: min-content;
    } */
    main.new-task-page {
      margin: 0 1vw 0 1vw;
    }
    #submit-button {
      font-size: 1em;
      margin: 1em 1em 1em 1.5em;
      height: fit-content;
      transition-duration: 1s;
      transition-property: margin;
    }
    @media(max-width: 364px){
      #submit-button{
        margin: 1em 50% 0 40%;
        
      }
    }
  </style>
</head>
<body class="new-task-page">
    <header id="site-wide-nav-header">
      
    </header>
    <main class="new-task-page">
      <form>
        <fieldset>
          <legend>New Task</legend>
          <input name="taskName" type="text" maxlength="50" placeholder="Task Name Here" required>
        </fieldset>
        <fieldset id="lvlOfImportance">
          <label for="eminanceOfFailure">Eminance of Failure when missed</label>
          <select name="eminanceOfFailure" id="eminanceOfFailure" placeholder="Please Choose..." onchange="showTheThing('eminanceOfFailure', 'Cumulative', 'cumulaNum')" required>
            <option>Immediate</option>
            <option>Cumulative</option>
            <option>Nugatory</option>
          </select>
          <label for="cumulaNum" id="cumulaNumLabel" hidden>Cumulative Limit Before Failure</label>
          <input name="cumulaNum" id="cumulaNum" type="number" step="1" hidden>
        </fieldset>
        <fieldset>
          <label for="taskUnits">Units of Measurement</label>
          <select name="taskUnits" id="taskUnits" placeholder="Please Choose..." onchange="showTheThing('taskUnits', 'Custom Units', 'customUnits')" required>
            <option>Number (No Units)</option>
            <option>Custom Units</option>
            <option>Time</option>
          </select>
          <label for="taskQuantity">Quantity Needed to Complete</label>
          <input name="taskQuantity" type="number" value="1" required>
          <label for="customUnits" id="customUnitsLabel" hidden>Custom Units Name</label>
          <input name="customUnits" id="customUnits" type="text" hidden>
        </fieldset>
        <fieldset>
          <label for="taskHourReset">Reset at this time of day</label>
          <input name="taskHourReset" type="time" value="06:00"> <!--note, be sure to make this one automatically reset at midnight if no number is given...somehow.-->
          <label for="taskDayReset">Reset after this many days</label>
          <input name="taskDayReset" type="number" value="1" size="" required>
          <label for="taskTimeAllowed">Time allowed for completion (in minutes)</label>
          <input name="taskTimeAllowed" type="number" required>
        </fieldset>
        <fieldset>
          <!-- <label for=""></label>
          <input name="" type="">
          <label for=""></label>
          <input name="" type=""> -->
          <label for="desc">Additional Notes:</label>
          <textarea name="desc" id="desc" maxlength="555" placeholder="Write notes here..."></textarea>
        </fieldset>
        <button id="submit-button" onclick="getAndSetParams(event)">Submit</button>
      </form>
      
    </main>
    <footer id="main-footer">

    </footer>
</body>
<script src="/Site-Stuff/Scripting/Snippets/template_level_snippets.js"></script>
<script>
  //filling inputs if available
  let params = new URLSearchParams(window.location.search);
  let currentTask = params.get("taskName");
  if(currentTask){
    console.log(`1. ${localStorage.getItem("Task-List")}`)
    let taskInfo = JSON.parse(localStorage.getItem("Task-List"));
    console.log(`2. ${taskInfo}`)
  }
  function getAndSetParams(event) {
    // Prevent the default form submission behavior
    event.preventDefault();
    // Create a new object to store the form data
    let newTask = {};

    // Get the values from the form and add them to the new object
    newTask.eminanceOfFailure = params.get("eminanceOfFailure");
    newTask.cumulaNum = params.get("cumulaNum");
    newTask.taskUnits = params.get("taskUnits");
    newTask.taskQuantity = params.get("taskQuantity");
    newTask.customUnits = params.get("customUnits");
    newTask.taskHourReset = params.get("taskHourReset");
    newTask.taskDayReset = params.get("taskDayReset");
    newTask.taskTimeAllowed = params.get("taskTimeAllowed");
    newTask.desc = params.get("desc");

    // Get the current list of tasks from localStorage
    let taskList = {};
    if (localStorage.getItem("Task-List")) {
      taskList = JSON.parse(localStorage.getItem("Task-List"));
    }

    // Set the new task in the taskList object
    taskList[newTask.taskName] = newTask;

    // Store the updated list back in localStorage
    localStorage.setItem("Task-List", JSON.stringify(taskList));
  }

  // getAndSetParams();


  function showTheThing(theId, verifyText, theThingsId){
    let theThingOption = document.getElementById(`${theId}`).value;
    let theThing = document.getElementById(`${theThingsId}`);
    let theThingsLabel = document.getElementById(`${theThingsId}Label`)

    if(theThingOption === verifyText){
      theThing.removeAttribute("hidden");
      theThingsLabel.removeAttribute("hidden");
      theThing.required = true;
      theThingsLabel.required = true;
      console.log("Ohhh")
    } else {
      theThing.hidden = true;
      theThingsLabel.hidden = true;
      theThing.removeAttribute("required");
      theThingsLabel.removeAttribute("required");
      console.log("snap")
    }
  }
  function setUnitOfMeasurement(){
    let unitOption = document.getElementById("taskUnits")
  }

  

  function storeFormData(){
    console.log("yeah");
  }
  function displayTaskInfo(){

  }
  
</script>
</html>
<!-- cumulaNum=5&taskUnits=Number+%28No+Units%29&taskQuantity=30&customUnits=&taskHourReset=06%3A00&taskDayReset=1&taskTimeAllowed=1440&desc= -->